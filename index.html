<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>VA 526EZ Maximal JSON → Page Buckets + Compare</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <style>
        :root {
            --bg: #0b0c0f;
            --panel: #121419;
            --text: #e8eaed;
            --muted: #a7b0ba;
            --accent: #7cc5ff;
            --chip: #202a38;
            --border: #2a3038;
            --card: #0f1216;
            --input: #0f1114;
            --shadow: 0 10px 30px rgba(0, 0, 0, .35);
            --ring: 0 0 0 3px rgba(124, 197, 255, .25);
            --link: #9dd6ff;
            --added: #1c5e2d;
            --removed: #6e1f28;
            --changed: #6a5516;
        }

        @media (prefers-color-scheme: light) {
            :root {
                --bg: #f7f9fc;
                --panel: #fff;
                --text: #0b1220;
                --muted: #5b697a;
                --accent: #0b74d0;
                --chip: #eef5ff;
                --border: #e8edf3;
                --card: #fff;
                --input: #fff;
                --shadow: 0 8px 24px rgba(6, 24, 44, .08);
                --ring: 0 0 0 3px rgba(11, 116, 208, .15);
                --link: #0b74d0;
                --added: #dff5e7;
                --removed: #fde2e5;
                --changed: #fff2cc;
            }
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font: 15px/1.55 Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
            color: var(--text);
            background: var(--bg)
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 28px 20px 40px
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px
        }

        .title {
            display: flex;
            align-items: center;
            gap: 12px
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: grid;
            place-items: center;
            background: linear-gradient(180deg, var(--chip), transparent);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            font-weight: 800;
            color: var(--accent)
        }

        h1 {
            margin: 0;
            font-size: 18px
        }

        .sub {
            margin: 2px 0 0;
            color: var(--muted);
            font-size: 13px
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin: 16px 0
        }

        .tab {
            border: 1px solid var(--border);
            background: var(--panel);
            color: var(--text);
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600
        }

        .tab.active {
            outline: 2px solid color-mix(in oklab, var(--accent) 40%, transparent)
        }

        .grid {
            display: grid;
            gap: 18px;
            grid-template-columns: 1fr
        }

        @media (min-width:1100px) {
            .grid {
                grid-template-columns: 360px 1fr
            }
        }

        .card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow)
        }

        .card .inner {
            padding: 16px
        }

        .toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 10px
        }

        label {
            display: block;
            font-weight: 600;
            margin: 12px 0 8px;
            color: var(--muted);
            font-size: 12px;
            text-transform: uppercase
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--input);
            color: var(--text);
            outline: none
        }

        textarea {
            min-height: 220px;
            resize: vertical;
            font-family: ui-monospace, monospace
        }

        .btn {
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600
        }

        .btn:hover {
            filter: brightness(1.05)
        }

        .btn.primary {
            background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 28%, transparent), transparent)
        }

        .search {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap
        }

        .stats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 12px
        }

        .stat {
            background: var(--card);
            padding: 6px 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
            font-size: 13px;
            color: var(--muted)
        }

        .pages {
            display: grid;
            gap: 14px;
            padding: 12px
        }

        details.page {
            border: 1px solid var(--border);
            border-radius: 14px;
            background: var(--card)
        }

        details.page>summary {
            list-style: none;
            padding: 12px 14px;
            cursor: pointer;
            display: flex;
            gap: 10px
        }

        details.page>summary::-webkit-details-marker {
            display: none
        }

        .badge {
            margin-left: auto;
            background: var(--chip);
            color: var(--accent);
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px
        }

        .list {
            padding: 10px 14px 14px;
            display: grid;
            gap: 10px
        }

        .item {
            display: grid;
            gap: 6px;
            padding: 12px;
            border: 1px dashed var(--border);
            border-radius: 10px;
            background: var(--card)
        }

        .key {
            font-family: monospace;
            color: var(--accent);
            font-size: 13px
        }

        .small {
            font-size: 12px;
            color: var(--muted)
        }

        .value {
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-word;
            color: var(--text);
            background: var(--input);
            border: 1px solid var(--border);
            padding: 8px;
            border-radius: 8px;
            font-size: 12.5px
        }

        /* Diff pills */
        .pill {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            border: 1px solid var(--border);
            font-size: 11px
        }

        .pill.added {
            background: var(--added)
        }

        .pill.removed {
            background: var(--removed)
        }

        .pill.changed {
            background: var(--changed)
        }

        .two-cols {
            display: grid;
            gap: 12px
        }

        @media (min-width:1100px) {
            .two-cols {
                grid-template-columns: 1fr 1fr
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="title">
                <div class="logo">VA</div>
                <div>
                    <h1>526EZ Maximal JSON → Page Buckets</h1>
                    <div class="sub">Explore or compare JSON (local-only).</div>
                </div>
            </div>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button id="tab-explore" class="tab active">Explore</button>
            <button id="tab-compare" class="tab">Compare</button>
        </div>

        <!-- EXPLORE VIEW -->
        <section id="view-explore">
            <div class="grid">
                <div class="card">
                    <div class="inner">
                        <div class="toolbar">
                            <button class="btn primary" id="btn-load-url">Fetch from URL</button>
                            <button class="btn" id="btn-try-sample">Load sample</button>
                            <button class="btn" id="btn-parse">Parse JSON</button>
                            <button class="btn" id="btn-clear">Clear</button>
                        </div>

                        <label for="url">JSON URL (raw)</label>
                        <input id="url" type="text"
                            placeholder="https://raw.githubusercontent.com/.../maximal-test.json" />

                        <label for="json">Maximal JSON</label>
                        <textarea id="json" placeholder="Paste the maximal-test.json contents here"></textarea>

                        <div class="search">
                            <input id="filter" type="text" placeholder="Filter keys/values…" />
                            <button class="btn" id="btn-copy-report">Copy page counts</button>
                            <button class="btn" id="btn-copy-pages">Copy page list</button>
                        </div>

                        <div class="search">
                            <select id="page-select"
                                style="flex:1; padding:10px; border-radius:10px; border:1px solid var(--border); background:var(--input); color:var(--text);">
                                <option value="" selected disabled>Pick a page…</option>
                            </select>
                            <button class="btn" id="btn-show-page">Show page</button>
                            <button class="btn" id="btn-show-all">Show all</button>
                        </div>

                        <div class="stats" id="stats"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="pages" id="output"></div>
                </div>
            </div>
        </section>

        <!-- COMPARE VIEW -->
        <section id="view-compare" style="display:none">
            <div class="grid">
                <div class="card">
                    <div class="inner">
                        <div class="toolbar">
                            <button class="btn primary" id="btn-diff-parse">Parse & Diff</button>
                            <button class="btn" id="btn-diff-swap">Swap A ↔ B</button>
                            <button class="btn" id="btn-diff-clear">Clear</button>
                        </div>

                        <div class="two-cols">
                            <div>
                                <label for="urlA">JSON A URL</label>
                                <div class="search">
                                    <input id="urlA" type="text"
                                        placeholder="https://raw.githubusercontent.com/.../maximal-test.json" />
                                    <button class="btn" id="btn-fetch-A">Fetch A</button>
                                </div>
                                <label for="jsonA">JSON A</label>
                                <textarea id="jsonA" placeholder="Paste JSON A"></textarea>
                            </div>

                            <div>
                                <label for="urlB">JSON B URL</label>
                                <div class="search">
                                    <input id="urlB" type="text"
                                        placeholder="https://raw.githubusercontent.com/.../maximal-test.json" />
                                    <button class="btn" id="btn-fetch-B">Fetch B</button>
                                </div>
                                <label for="jsonB">JSON B</label>
                                <textarea id="jsonB" placeholder="Paste JSON B"></textarea>
                            </div>
                        </div>

                        <div class="search">
                            <input id="diff-filter" type="text" placeholder="Filter diff keys/values…" />
                            <button class="btn" id="btn-copy-diff-summary">Copy diff summary</button>
                        </div>

                        <div class="stats" id="diff-stats"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="pages" id="diff-output"></div>
                </div>
            </div>
        </section>
    </div>

    <script>
        // ---------- Page bucketing rules ----------
        const PAGE_RULES = [
            { name: "Claim Type", patterns: [/^view:claimType/, /^standardClaim$/, /^view:fdcWarning/] },
            { name: "Employment / Terminal / VA Employee", patterns: [/^isVaEmployee$/, /^isTerminallyIll$/] },
            { name: "Homelessness", patterns: [/^homelessOrAtRisk/, /^view:isHomeless/, /^homelessnessContact/] },
            { name: "Contact Information", patterns: [/^phoneAndEmail/, /^mailingAddress/, /^view:hasForwardingAddress/, /^forwardingAddress/, /^view:contactInfoDescription/] },
            { name: "Direct Deposit", patterns: [/^view:bankAccount$/, /^view:originalBankAccount$/] },
            { name: "Evidence & Uploads", patterns: [/^additionalDocuments/, /^view:uploadPrivateRecordsQualifier/, /^privateMedicalRecordAttachments/, /^view:vaMedicalRecordsIntro/, /^vaTreatmentFacilities/, /^view:hasEvidence/, /^view:selectableEvidenceTypes/, /^view:evidenceTypeHelp/] },
            { name: "Special Circumstances", patterns: [/^view:unemployable$/, /^view:aidAndAttendance$/, /^view:modifyingHome$/, /^view:modifyingCar$/, /^view:needsCarHelp/, /^view:powStatus$/, /^view:isPow/] },
            { name: "New Disabilities", patterns: [/^newDisabilities/] },
            { name: "Rated Disabilities", patterns: [/^ratedDisabilities/, /^view:disabilitiesClarification/] },
            { name: "Service Information", patterns: [/^serviceInformation/] },
            { name: "PTSD Incidents & 781/781a", patterns: [/^view:selectablePtsdTypes/, /^view:ptsdTypeHelp/, /^view:upload781ChoiceHelp/, /^incident\d+/, /^view:upload781aChoiceHelp$/, /^secondaryIncident\d+/, /^view:otherSourcesHelp$/] },
            { name: "Behavior Changes", patterns: [/^(physicalChanges|mentalChanges|workBehaviorChanges|socialBehaviorChanges)$/] },
            { name: "Unemployability (8940)", patterns: [/^view:unemployabilityHelp$/, /^unemployability/, /^view:privateMedicalFacility$/, /^view:upload4192Choice$/, /^view:downloadInfo$/, /^view:privateRecordsChoiceHelp$/] },
            { name: "FAQ / Ancillary", patterns: [/^view:ancillaryFormsWizardIntro$/, /^view:faqAccordion$/] },
        ];
        const UNMAPPED = "Unmapped";

        // ---------- Explore helpers ----------
        let LAST_PAGES = null;

        function flatten(obj, prefix = "") {
            const out = [];
            const isObj = v => v && typeof v === "object" && !Array.isArray(v);
            function step(value, p) {
                if (Array.isArray(value)) {
                    out.push({ key: p, value });
                    value.forEach(v => {
                        const childKey = p ? `${p}[]` : "[]";
                        if (isObj(v) || Array.isArray(v)) step(v, childKey);
                        else out.push({ key: childKey, value: v });
                    });
                } else if (isObj(value)) {
                    const keys = Object.keys(value);
                    if (p) out.push({ key: p, value });
                    if (!keys.length) out.push({ key: p, value });
                    keys.forEach(k => step(value[k], p ? `${p}.${k}` : k));
                } else {
                    out.push({ key: p, value });
                }
            }
            step(obj, prefix);
            return out;
        }

        function extractDataRoot(json) {
            if (!json || typeof json !== "object") return {};
            if (json.data && typeof json.data === "object") return json.data;
            if (json.formData && typeof json.formData === "object") return json.formData;
            if (json.attributes && typeof json.attributes === "object") return json.attributes;
            if (json.submission && typeof json.submission === "object") return json.submission;
            const keys = Object.keys(json);
            if (keys.length === 1 && typeof json[keys[0]] === "object") return json[keys[0]];
            return json;
        }

        function pageFor(rootKey) {
            for (const rule of PAGE_RULES) if (rule.patterns.some(re => re.test(rootKey))) return rule.name;
            return UNMAPPED;
        }

        function groupByPages(data) {
            const flat = flatten(data);
            const buckets = new Map();
            const stripWrappers = (k) => {
                if (!k) return k;
                const parts = k.split(".");
                const wrappers = new Set(["data", "formData", "attributes", "submission"]);
                return wrappers.has(parts[0]) ? (parts[1] || parts[0]) : parts[0];
            };
            for (const row of flat) {
                const rootKey = stripWrappers(row.key || "");
                if (!rootKey) continue;
                if (!buckets.has(rootKey)) buckets.set(rootKey, []);
                buckets.get(rootKey).push(row);
            }
            const pages = new Map();
            for (const [rootKey, entries] of buckets.entries()) {
                const page = pageFor(rootKey);
                if (!pages.has(page)) pages.set(page, []);
                pages.get(page).push({ rootKey, entries });
            }
            return pages;
        }

        const $ = sel => document.querySelector(sel);
        function el(tag, attrs = {}, ...children) {
            const node = document.createElement(tag);
            for (const [k, v] of Object.entries(attrs)) {
                if (k === "class") node.className = v;
                else if (k.startsWith("on") && typeof v === "function") node.addEventListener(k.substring(2), v);
                else node.setAttribute(k, v);
            }
            for (const c of children) if (c != null) node.appendChild(typeof c === "string" ? document.createTextNode(c) : c);
            return node;
        }
        function safeStringify(v, max = 220) { let s; try { s = typeof v === "string" ? v : JSON.stringify(v) } catch { s = String(v); } if (s.length > max) s = s.slice(0, max) + " …"; return s; }

        function render(pages, filterText = "", onlyPage = null) {
            const out = $("#output"), stats = $("#stats"); out.innerHTML = ""; stats.innerHTML = "";
            const filter = (filterText || "").toLowerCase(); let totalRoots = 0, totalItems = 0;
            const pageOrder = [...PAGE_RULES.map(r => r.name), UNMAPPED].filter(n => pages.has(n));
            const effectiveOrder = onlyPage ? pageOrder.filter(n => n === onlyPage) : pageOrder;
            for (const pageName of effectiveOrder) {
                const groups = pages.get(pageName) || []; if (!groups.length) continue;
                groups.sort((a, b) => a.rootKey.localeCompare(b.rootKey));
                const pageCount = groups.reduce((a, g) => a + g.entries.length, 0);
                totalRoots += groups.length; totalItems += pageCount;
                const details = el("details", { class: "page", open: true });
                details.appendChild(el("summary", {}, pageName, el("span", { class: "badge" }, `${groups.length} roots • ${pageCount} items`)));
                const list = el("div", { class: "list" });
                for (const { rootKey, entries } of groups) {
                    const filtered = entries.filter(e => !filter || e.key.toLowerCase().includes(filter) || JSON.stringify(e.value).toLowerCase().includes(filter));
                    if (!filtered.length) continue;
                    const item = el("div", { class: "item" }, el("div", { class: "key" }, rootKey));
                    for (const e of filtered) { item.appendChild(el("div", { class: "small" }, e.key)); item.appendChild(el("div", { class: "value" }, safeStringify(e.value, 300))); }
                    list.appendChild(item);
                }
                details.appendChild(list); out.appendChild(details);
            }
            stats.appendChild(el("div", { class: "stat" }, `Pages: ${effectiveOrder.length}`));
            stats.appendChild(el("div", { class: "stat" }, `Root keys: ${totalRoots}`));
            stats.appendChild(el("div", { class: "stat" }, `Items: ${totalItems}`));
        }

        function populatePageSelect(pages) {
            const sel = $("#page-select"); sel.innerHTML = '<option value="" selected disabled>Pick a page…</option>';
            const order = [...PAGE_RULES.map(r => r.name), UNMAPPED].filter(n => pages.has(n));
            for (const name of order) { const opt = document.createElement("option"); opt.value = name; opt.textContent = name; sel.appendChild(opt); }
        }

        function parseAndRender() {
            let json; try { json = JSON.parse($("#json").value || "{}"); } catch (e) { return alert("Invalid JSON"); }
            const data = extractDataRoot(json) || {}; const pages = groupByPages(data);
            LAST_PAGES = pages; populatePageSelect(pages); render(pages, $("#filter").value);
        }

        // ---------- Compare helpers ----------
        function flattenToMap(obj) {
            // Returns Map<dotPath, stringifiedValue> with array indexes normalized
            const rows = flatten(obj);
            const norm = (p) => String(p || "").replace(/\[\d+\]/g, "[]");
            const map = new Map();
            for (const r of rows) {
                const k = norm(r.key);
                let v; try { v = typeof r.value === "string" ? r.value : JSON.stringify(r.value); } catch { v = String(r.value); }
                map.set(k, v);
            }
            return map;
        }

        function diffJSON(a, b) {
            // Returns { added:[], removed:[], changed:[] } of dot paths
            const A = flattenToMap(a);
            const B = flattenToMap(b);
            const added = [], removed = [], changed = [];
            const keysA = new Set(A.keys());
            const keysB = new Set(B.keys());

            for (const k of keysB) { if (!keysA.has(k)) added.push(k); }
            for (const k of keysA) { if (!keysB.has(k)) removed.push(k); }
            for (const k of keysB) {
                if (keysA.has(k) && A.get(k) !== B.get(k)) changed.push(k);
            }
            return { added: added.sort(), removed: removed.sort(), changed: changed.sort() };
        }

        function pageForPath(path) {
            const root = (path || "").split(".")[0].replace(/^data\.|^formData\.|^attributes\.|^submission\./, "");
            return pageFor(root);
        }

        function renderDiffSummary(diff, filterText = "") {
            const out = $("#diff-output"), stats = $("#diff-stats"); out.innerHTML = ""; stats.innerHTML = "";
            const filter = (filterText || "").toLowerCase();

            // Group each class by page
            const classes = [
                { key: "added", label: "Added", cls: "added" },
                { key: "removed", label: "Removed", cls: "removed" },
                { key: "changed", label: "Changed", cls: "changed" },
            ];

            let total = 0;
            for (const cls of classes) total += diff[cls.key].length;
            stats.appendChild(el("div", { class: "stat" }, `Diff total: ${total}`));
            stats.appendChild(el("div", { class: "stat" }, `Added: ${diff.added.length}`));
            stats.appendChild(el("div", { class: "stat" }, `Removed: ${diff.removed.length}`));
            stats.appendChild(el("div", { class: "stat" }, `Changed: ${diff.changed.length}`));

            const pagesMap = new Map(); // Map<pageName, Array<{kind,path}>>
            for (const kind of classes) {
                for (const p of diff[kind.key]) {
                    if (filter && !p.toLowerCase().includes(filter)) continue;
                    const page = pageForPath(p);
                    if (!pagesMap.has(page)) pagesMap.set(page, []);
                    pagesMap.get(page).push({ kind: kind.label, cls: kind.cls, path: p });
                }
            }

            const order = [...PAGE_RULES.map(r => r.name), UNMAPPED].filter(n => pagesMap.has(n));
            for (const pageName of order) {
                const entries = pagesMap.get(pageName);
                const details = el("details", { class: "page", open: true });
                details.appendChild(el("summary", {}, pageName, el("span", { class: "badge" }, `${entries.length} changes`)));
                const list = el("div", { class: "list" });
                for (const e of entries) {
                    list.appendChild(
                        el("div", { class: "item" },
                            el("div", {}, el("span", { class: `pill ${e.cls}` }, e.kind)),
                            el("div", { class: "small" }, e.path)
                        )
                    );
                }
                details.appendChild(list);
                out.appendChild(details);
            }
        }

        // ---------- EXPLORE wiring ----------
        $("#btn-load-url").onclick = async () => { try { const res = await fetch($("#url").value.trim()); $("#json").value = await res.text(); parseAndRender(); } catch (e) { alert("Fetch failed"); } };
        $("#btn-try-sample").onclick = () => { $("#json").value = JSON.stringify({ data: { "view:claimType": { "view:claimingIncrease": true }, "phoneAndEmail": { "primaryPhone": "123" }, "view:bankAccount": { "bankAccountType": "Checking" }, "newDisabilities": [{ cause: "NEW", condition: "asthma" }], "incident0": { incidentLocation: { country: "USA" } } } }, null, 2); parseAndRender(); };
        $("#btn-parse").onclick = parseAndRender;
        $("#btn-clear").onclick = () => { $("#json").value = ""; $("#output").innerHTML = ""; $("#stats").innerHTML = ""; $("#filter").value = ""; };
        $("#filter").oninput = () => { if (LAST_PAGES) render(LAST_PAGES, $("#filter").value); };
        $("#btn-copy-report").onclick = () => {
            if (!LAST_PAGES) return; const order = [...PAGE_RULES.map(r => r.name), UNMAPPED].filter(n => LAST_PAGES.has(n));
            const lines = []; for (const name of order) { const groups = LAST_PAGES.get(name) || []; const count = groups.reduce((a, g) => a + g.entries.length, 0); lines.push(`${name}: ${groups.length} roots • ${count} items`); for (const g of groups) lines.push(`  - ${g.rootKey}`); }
            navigator.clipboard.writeText(lines.join("\n")); alert("Copied page counts.");
        };
        $("#btn-copy-pages").onclick = () => {
            if (!LAST_PAGES) return; const order = [...PAGE_RULES.map(r => r.name), UNMAPPED].filter(n => LAST_PAGES.has(n));
            navigator.clipboard.writeText(order.join("\n")); alert("Copied page list.");
        };
        $("#btn-show-page").onclick = () => { if (!LAST_PAGES) return; const page = $("#page-select").value; if (!page) return alert("Pick a page first."); render(LAST_PAGES, $("#filter").value, page); };
        $("#btn-show-all").onclick = () => { if (LAST_PAGES) render(LAST_PAGES, $("#filter").value, null); };
        $("#url").value = "https://raw.githubusercontent.com/department-of-veterans-affairs/vets-website/main/src/applications/disability-benefits/all-claims/tests/fixtures/data/transformed-data/maximal-test.json";

        // ---------- COMPARE wiring ----------
        $("#btn-fetch-A").onclick = async () => { try { const res = await fetch($("#urlA").value.trim()); $("#jsonA").value = await res.text(); } catch (e) { alert("Fetch A failed"); } };
        $("#btn-fetch-B").onclick = async () => { try { const res = await fetch($("#urlB").value.trim()); $("#jsonB").value = await res.text(); } catch (e) { alert("Fetch B failed"); } };
        $("#btn-diff-swap").onclick = () => { const a = $("#jsonA").value, b = $("#jsonB").value; $("#jsonA").value = b; $("#jsonB").value = a; };
        $("#btn-diff-clear").onclick = () => { $("#jsonA").value = ""; $("#jsonB").value = ""; $("#diff-output").innerHTML = ""; $("#diff-stats").innerHTML = ""; $("#diff-filter").value = ""; };

        $("#btn-diff-parse").onclick = () => {
            let A, B;
            try { A = extractDataRoot(JSON.parse($("#jsonA").value || "{}")); } catch (e) { return alert("JSON A invalid"); }
            try { B = extractDataRoot(JSON.parse($("#jsonB").value || "{}")); } catch (e) { return alert("JSON B invalid"); }
            const diff = diffJSON(A, B);
            renderDiffSummary(diff, $("#diff-filter").value);
        };
        $("#diff-filter").oninput = () => { $("#btn-diff-parse").click(); };

        // ---------- Tabs ----------
        function showTab(which) {
            const ex = $("#view-explore"), cp = $("#view-compare");
            $("#tab-explore").classList.toggle("active", which === "explore");
            $("#tab-compare").classList.toggle("active", which === "compare");
            ex.style.display = which === "explore" ? "" : "none";
            cp.style.display = which === "compare" ? "" : "none";
        }
        $("#tab-explore").onclick = () => showTab("explore");
        $("#tab-compare").onclick = () => showTab("compare");
    </script>
</body>

</html>