<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>VA 526EZ Maximal JSON → Page Buckets</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="color-scheme" content="light dark" />
    <style>
        /* --- Design tokens (auto light/dark) --- */
        :root {
            --bg: #0b0c0f;
            --panel: #121419;
            --text: #e8eaed;
            --muted: #a7b0ba;
            --accent: #7cc5ff;
            --chip: #202a38;
            --border: #2a3038;
            --card: #0f1216;
            --input: #0f1114;
            --shadow: 0 10px 30px rgba(0, 0, 0, .35);
            --ring: 0 0 0 3px rgba(124, 197, 255, .25);
            --link: #9dd6ff;
        }

        @media (prefers-color-scheme: light) {
            :root {
                --bg: #f7f9fc;
                --panel: #ffffff;
                --text: #0b1220;
                --muted: #5b697a;
                --accent: #0b74d0;
                --chip: #eef5ff;
                --border: #e8edf3;
                --card: #ffffff;
                --input: #ffffff;
                --shadow: 0 8px 24px rgba(6, 24, 44, .08);
                --ring: 0 0 0 3px rgba(11, 116, 208, .15);
                --link: #0b74d0;
            }
        }

        /* --- Base --- */
        * {
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            font: 15px/1.55 Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
            color: var(--text);
            background: radial-gradient(1200px 600px at 20% -10%, rgba(124, 197, 255, .08), transparent 60%),
                radial-gradient(1200px 700px at 120% -20%, rgba(124, 197, 255, .06), transparent 65%),
                var(--bg);
        }

        a {
            color: var(--link);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        /* --- Layout --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 28px 20px 40px;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 16px;
        }

        .title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: grid;
            place-items: center;
            background: linear-gradient(180deg, var(--chip), transparent);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            font-weight: 800;
            color: var(--accent);
        }

        h1 {
            margin: 0;
            font-size: 18px;
            letter-spacing: .2px;
        }

        .sub {
            margin: 2px 0 0;
            color: var(--muted);
            font-size: 13px;
        }

        /* --- Grid --- */
        .grid {
            display: grid;
            gap: 18px;
            grid-template-columns: 1fr;
        }

        @media (min-width: 1100px) {
            .grid {
                grid-template-columns: 360px 1fr;
            }
        }

        /* --- Card --- */
        .card {
            background: var(--panel);
            border: 1px solid var(--border);
            border-radius: 16px;
            box-shadow: var(--shadow);
            overflow: clip;
        }

        .card .inner {
            padding: 16px;
        }

        .toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        /* --- Controls --- */
        label {
            display: block;
            font-weight: 600;
            margin: 12px 0 8px;
            color: var(--muted);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: .4px;
        }

        input[type="text"],
        textarea {
            width: 100%;
            padding: 12px 12px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--input);
            color: var(--text);
            outline: none;
        }

        input[type="text"]:focus,
        textarea:focus {
            box-shadow: var(--ring);
            border-color: transparent;
        }

        textarea {
            min-height: 220px;
            resize: vertical;
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        }

        .btn {
            appearance: none;
            border: 1px solid var(--border);
            background: var(--card);
            color: var(--text);
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: transform .02s ease, filter .15s ease;
        }

        .btn:hover {
            filter: brightness(1.05);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn.primary {
            background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 28%, transparent), transparent);
            border-color: color-mix(in oklab, var(--accent) 45%, var(--border));
        }

        .hint {
            color: var(--muted);
            font-size: 12px;
            margin-top: 8px;
        }

        .search {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .stats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .stat {
            background: var(--card);
            padding: 6px 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
            font-size: 13px;
            color: var(--muted);
        }

        /* --- Pages --- */
        .pages {
            display: grid;
            gap: 14px;
            padding: 12px;
        }

        details.page {
            border: 1px solid var(--border);
            border-radius: 14px;
            background: var(--card);
            overflow: hidden;
        }

        details.page>summary {
            list-style: none;
            padding: 12px 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(180deg, color-mix(in oklab, var(--card) 75%, var(--chip)), var(--card));
            border-bottom: 1px solid var(--border);
        }

        details.page>summary::-webkit-details-marker {
            display: none;
        }

        .badge {
            margin-left: auto;
            background: var(--chip);
            color: var(--accent);
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px;
            border: 1px solid var(--border);
        }

        .list {
            padding: 10px 14px 14px;
            display: grid;
            gap: 10px;
        }

        .item {
            display: grid;
            gap: 6px;
            padding: 12px;
            border: 1px dashed var(--border);
            border-radius: 10px;
            background: color-mix(in oklab, var(--card) 90%, var(--chip));
        }

        .key {
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            color: var(--accent);
            font-size: 13px;
        }

        .small {
            font-size: 12px;
            color: var(--muted);
        }

        .value {
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
            white-space: pre-wrap;
            word-break: break-word;
            color: var(--text);
            background: var(--input);
            border: 1px solid var(--border);
            padding: 8px 10px;
            border-radius: 8px;
            font-size: 12.5px;
        }

        .pill {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 8px;
            background: var(--chip);
            color: var(--text);
            border: 1px solid var(--border);
            font-size: 11px;
        }

        footer {
            margin-top: 14px;
            color: var(--muted);
            font-size: 12px;
            text-align: right;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="title">
                <div class="logo">VA</div>
                <div>
                    <h1>526EZ Maximal JSON → Page Buckets</h1>
                    <div class="sub">Paste the maximal JSON or fetch from the repo URL. Local-only — nothing is
                        uploaded.</div>
                </div>
            </div>
            <div><a href="https://github.com/arperry87/vets-maximal-page-grouper" target="_blank" rel="noopener">GitHub
                    ↗</a></div>
        </header>

        <div class="grid">
            <div class="card">
                <div class="inner">
                    <div class="toolbar">
                        <button class="btn primary" id="btn-load-url">Fetch from URL</button>
                        <button class="btn" id="btn-try-sample">Load sample</button>
                        <button class="btn" id="btn-parse">Parse JSON</button>
                        <button class="btn" id="btn-clear">Clear</button>
                    </div>

                    <label for="url">JSON URL (raw)</label>
                    <input id="url" type="text" placeholder="https://raw.githubusercontent.com/.../maximal-test.json" />

                    <label for="json">Maximal JSON</label>
                    <textarea id="json" placeholder="Paste the maximal-test.json contents here"></textarea>
                    <div class="hint">
                        Path in vets-website:
                        <span
                            class="pill">src/applications/disability-benefits/all-claims/tests/fixtures/data/transformed-data/maximal-test.json</span>
                    </div>

                    <div class="search">
                        <input id="filter" type="text" placeholder="Filter keys/values…" />
                        <button class="btn" id="btn-copy-report">Copy page counts</button>
                    </div>

                    <div class="stats" id="stats"></div>
                    <footer>Theme adapts to your OS light/dark.</footer>
                </div>
            </div>

            <div class="card">
                <div class="pages" id="output"></div>
            </div>
        </div>
    </div>

    <script>
        // --- PAGE RULES (tuned to 526EZ all-claims). Edit as needed. ---
        const PAGE_RULES = [
            { name: "Claim Type", patterns: [/^view:claimType/, /^standardClaim$/, /^view:fdcWarning/] },
            { name: "Employment / Terminal / VA Employee", patterns: [/^isVaEmployee$/, /^isTerminallyIll$/] },
            { name: "Homelessness", patterns: [/^homelessOrAtRisk/, /^view:isHomeless/, /^homelessnessContact/] },
            { name: "Contact Information", patterns: [/^phoneAndEmail/, /^mailingAddress/, /^view:hasForwardingAddress/, /^forwardingAddress/, /^view:contactInfoDescription/] },
            { name: "Direct Deposit", patterns: [/^view:bankAccount$/, /^view:originalBankAccount$/] },
            {
                name: "Evidence & Uploads", patterns: [
                    /^additionalDocuments/, /^view:uploadPrivateRecordsQualifier/, /^privateMedicalRecordAttachments/,
                    /^view:vaMedicalRecordsIntro/, /^vaTreatmentFacilities/, /^view:hasEvidence/, /^view:selectableEvidenceTypes/, /^view:evidenceTypeHelp/
                ]
            },
            {
                name: "Special Circumstances", patterns: [
                    /^view:unemployable$/, /^view:aidAndAttendance$/, /^view:modifyingHome$/, /^view:modifyingCar$/,
                    /^view:needsCarHelp/, /^view:powStatus$/, /^view:isPow/
                ]
            },
            { name: "New Disabilities", patterns: [/^newDisabilities/] },
            { name: "Rated Disabilities", patterns: [/^ratedDisabilities/, /^view:disabilitiesClarification/] },
            { name: "Service Information", patterns: [/^serviceInformation/] },
            {
                name: "PTSD Incidents & 781/781a", patterns: [
                    /^view:selectablePtsdTypes/, /^view:ptsdTypeHelp/, /^view:upload781ChoiceHelp/,
                    /^incident\d+/, /^view:upload781aChoiceHelp$/, /^secondaryIncident\d+/, /^view:otherSourcesHelp$/
                ]
            },
            { name: "Behavior Changes", patterns: [/^(physicalChanges|mentalChanges|workBehaviorChanges|socialBehaviorChanges)$/] },
            {
                name: "Unemployability (8940)", patterns: [
                    /^view:unemployabilityHelp$/, /^unemployability/, /^view:privateMedicalFacility$/, /^view:upload4192Choice$/, /^view:downloadInfo$/, /^view:privateRecordsChoiceHelp$/
                ]
            },
            { name: "FAQ / Ancillary", patterns: [/^view:ancillaryFormsWizardIntro$/, /^view:faqAccordion$/] },
        ];
        const UNMAPPED = "Unmapped";

        // --- Flatten JSON to dot-paths ---
        function flatten(obj, prefix = "") {
            const out = [];
            const isObj = v => v && typeof v === "object" && !Array.isArray(v);
            function step(value, p) {
                if (Array.isArray(value)) {
                    out.push({ key: p, value });
                    value.forEach(v => {
                        const childKey = p ? `${p}[]` : "[]";
                        if (isObj(v) || Array.isArray(v)) {
                            step(v, childKey);
                        } else {
                            out.push({ key: childKey, value: v });
                        }
                    });
                } else if (isObj(value)) {
                    const keys = Object.keys(value);
                    if (p) out.push({ key: p, value });
                    if (!keys.length) out.push({ key: p, value });
                    keys.forEach(k => step(value[k], p ? `${p}.${k}` : k));
                } else {
                    out.push({ key: p, value });
                }
            }
            step(obj, prefix);
            return out;
        }

        function extractDataRoot(json) {
            if (json && typeof json === "object" && "data" in json && typeof json.data === "object") return json.data;
            return json;
        }
        function pageFor(rootKey) {
            for (const rule of PAGE_RULES) if (rule.patterns.some(re => re.test(rootKey))) return rule.name;
            return UNMAPPED;
        }
        function groupByPages(data) {
            const flat = flatten(data);
            const buckets = new Map();
            for (const row of flat) {
                const rootKey = (row.key || "").split(".")[0];
                if (!rootKey) continue;
                if (!buckets.has(rootKey)) buckets.set(rootKey, []);
                buckets.get(rootKey).push(row);
            }
            const pages = new Map();
            for (const [rootKey, entries] of buckets.entries()) {
                const page = pageFor(rootKey);
                if (!pages.has(page)) pages.set(page, []);
                pages.get(page).push({ rootKey, entries });
            }
            return pages;
        }

        // --- DOM helpers ---
        const $ = sel => document.querySelector(sel);
        function el(tag, attrs = {}, ...children) {
            const node = document.createElement(tag);
            for (const [k, v] of Object.entries(attrs)) {
                if (k === "class") node.className = v;
                else if (k.startsWith("on") && typeof v === "function") node.addEventListener(k.substring(2), v);
                else node.setAttribute(k, v);
            }
            for (const c of children) if (c != null) node.appendChild(typeof c === "string" ? document.createTextNode(c) : c);
            return node;
        }
        function safeStringify(v, max = 220) {
            let s;
            try { s = typeof v === "string" ? v : JSON.stringify(v, null, 0); } catch { s = String(v); }
            if (s.length > max) s = s.slice(0, max) + " …";
            return s;
        }

        function render(pages, filterText = "") {
            const out = $("#output"), stats = $("#stats");
            out.innerHTML = ""; stats.innerHTML = "";
            const filter = (filterText || "").trim().toLowerCase();
            let totalRoots = 0, totalItems = 0;

            const pageOrder = [...PAGE_RULES.map(r => r.name), UNMAPPED].filter(n => pages.has(n));
            for (const pageName of pageOrder) {
                const groups = pages.get(pageName) || [];
                if (!groups.length) continue;
                groups.sort((a, b) => a.rootKey.localeCompare(b.rootKey));
                const pageCount = groups.reduce((acc, g) => acc + g.entries.length, 0);
                totalRoots += groups.length; totalItems += pageCount;

                const details = el("details", { class: "page", open: true });
                const summary = el("summary", {}, el("span", {}, pageName), el("span", { class: "badge" }, `${groups.length} roots • ${pageCount} items`));
                const list = el("div", { class: "list" });

                for (const { rootKey, entries } of groups) {
                    const filtered = entries.filter(e => {
                        if (!filter) return true;
                        const k = e.key.toLowerCase();
                        let v; try { v = JSON.stringify(e.value).toLowerCase(); } catch { v = ""; }
                        return k.includes(filter) || v.includes(filter);
                    });
                    if (!filtered.length) continue;

                    const item = el("div", { class: "item" },
                        el("div", { class: "key" }, rootKey)
                    );
                    for (const e of filtered) {
                        item.appendChild(el("div", { class: "small" }, e.key));
                        item.appendChild(el("div", { class: "value" }, safeStringify(e.value, 300)));
                    }
                    list.appendChild(item);
                }

                details.appendChild(summary);
                details.appendChild(list);
                out.appendChild(details);
            }
            stats.appendChild(el("div", { class: "stat" }, `Pages: ${pageOrder.length}`));
            stats.appendChild(el("div", { class: "stat" }, `Root keys: ${totalRoots}`));
            stats.appendChild(el("div", { class: "stat" }, `Items: ${totalItems}`));
        }

        // --- Wire UI ---
        const $url = $("#url"), $json = $("#json"), $filter = $("#filter");

        $("#btn-load-url").onclick = async () => {
            const url = $url.value.trim();
            if (!url) return alert("Enter a URL to a raw JSON file.");
            try {
                const res = await fetch(url, { mode: "cors" });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                $json.value = await res.text();
                parseAndRender();
            } catch (err) {
                alert("Fetch failed: " + err.message + "\n\nTip: use a CORS-enabled raw URL (e.g., raw.githubusercontent.com). Or just paste the JSON.");
            }
        };
        $("#btn-try-sample").onclick = () => {
            $json.value = JSON.stringify({
                data: {
                    "view:claimType": { "view:claimingIncrease": true, "view:claimingNew": true },
                    "phoneAndEmail": { "primaryPhone": "4445551212", "emailAddress": "test@example.com" },
                    "view:bankAccount": { "bankAccountType": "Checking", "bankAccountNumber": "1233" },
                    "newDisabilities": [{ cause: "NEW", condition: "asthma" }],
                    "incident0": { incidentLocation: { country: "USA" } }
                }
            }, null, 2);
            parseAndRender();
        };
        $("#btn-parse").onclick = parseAndRender;
        $("#btn-clear").onclick = () => { $json.value = ""; $("#output").innerHTML = ""; $("#stats").innerHTML = ""; $filter.value = ""; };
        $filter.addEventListener("input", () => {
            try {
                const json = JSON.parse($json.value || "{}");
                const data = extractDataRoot(json) || {};
                const pages = groupByPages(data);
                render(pages, $filter.value);
            } catch { }
        });

        $("#btn-copy-report").onclick = () => {
            try {
                const json = JSON.parse($json.value || "{}");
                const data = extractDataRoot(json) || {};
                const pages = groupByPages(data);
                const order = [...PAGE_RULES.map(r => r.name), UNMAPPED].filter(n => pages.has(n));
                const lines = [];
                for (const name of order) {
                    const groups = pages.get(name) || [];
                    const count = groups.reduce((a, g) => a + g.entries.length, 0);
                    lines.push(`${name}: ${groups.length} root keys • ${count} items`);
                    for (const g of groups) lines.push(`  - ${g.rootKey}`);
                }
                navigator.clipboard.writeText(lines.join("\n"));
                alert("Copied summary to clipboard.");
            } catch (e) { alert("Nothing to copy yet. Parse a JSON first."); }
        };

        function parseAndRender() {
            let json;
            try { json = JSON.parse($json.value || "{}"); }
            catch (err) { return alert("Invalid JSON: " + err.message); }
            const data = extractDataRoot(json) || {};
            const pages = groupByPages(data);
            render(pages, $filter.value);
        }

        // Prefill the vetted raw URL for convenience
        $url.value = "https://raw.githubusercontent.com/department-of-veterans-affairs/vets-website/main/src/applications/disability-benefits/all-claims/tests/fixtures/data/transformed-data/maximal-test.json";
    </script>
</body>

</html>